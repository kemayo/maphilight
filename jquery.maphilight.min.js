(function(h){var b=document.namespaces,k=!!document.createElement("canvas").getContext,c,l,o,n,j,f,i,a,m;if(!(k||b)){h.fn.maphilight=function(){return this};return}var e=function(p,t){var w={x:0,y:0,width:0,height:0};switch(p){case"rect":w.x=t[0];w.y=t[1];w.width=t[2]-w.x;w.height=t[3]-w.y;break;case"poly":var v=t[0],u=t[0],s=t[1],r=t[1];for(var q=2;q<t.length;q+=2){v=Math.min(v,t[q]);u=Math.max(u,t[q]);s=Math.min(s,t[q+1]);r=Math.max(r,t[q+1])}w.x=v;w.y=s;w.width=u-w.x;w.height=r-w.y;break;case"circ":w.x=t[0]-t[2];w.y=t[1]-t[2];w.width=w.height=t[2]*2;break}return w};if(k){f=function(p){return Math.max(0,Math.min(parseInt(p,16),255))};i=function(p,q){return"rgba("+f(p.substr(0,2))+","+f(p.substr(2,2))+","+f(p.substr(4,2))+","+q+")"};c=function(p){var q=h('<canvas style="width:'+p.width+"px;height:"+p.height+'px;"></canvas>').get(0);q.getContext("2d").clearRect(0,0,q.width,q.height);return q};var g=function(s,p,t,r,u){r=r||0;u=u||0;s.beginPath();if(p=="rect"){s.rect(t[0]+r,t[1]+u,t[2]-t[0],t[3]-t[1])}else{if(p=="poly"){s.moveTo(t[0]+r,t[1]+u);for(var q=2;q<t.length;q+=2){s.lineTo(t[q]+r,t[q+1]+u)}}else{if(p=="circ"){s.arc(t[0]+r,t[1]+u,t[2],0,Math.PI*2,false)}}}s.closePath()};l=function(u,q,B,v){var r=u.getContext("2d");if(v.shadow){r.save();if(v.shadowPosition=="inside"){g(r,q,B);r.clip()}var t=u.width*100;var y=u.height*100;g(r,q,B,t,y);r.shadowOffsetX=v.shadowX-t;r.shadowOffsetY=v.shadowY-y;r.shadowBlur=v.shadowRadius;r.shadowColor=i(v.shadowColor,v.shadowOpacity);var z=v.shadowFrom;if(!z){if(v.shadowPosition=="outside"){z="fill"}else{z="stroke"}}if(z=="stroke"){r.strokeStyle="rgba(0,0,0,1)";r.stroke()}else{if(z=="fill"){r.fillStyle="rgba(0,0,0,1)";r.fill()}}r.restore();if(v.shadowPosition=="outside"){r.save();g(r,q,B);r.globalCompositeOperation="destination-out";r.fillStyle="rgba(0,0,0,1);";r.fill();r.restore()}}r.save();g(r,q,B);if(v.fill){r.fillStyle=i(v.fillColor,v.fillOpacity);r.fill()}if(v.stroke){r.strokeStyle=i(v.strokeColor,v.strokeOpacity);r.lineWidth=v.strokeWidth;r.stroke()}if(v.text){var H=e(q,B),F=H.x,E=H.y,D=v.text.split("\\n"),p=0,s=parseInt(v.textFontSize,10),G=v.textFontSize.replace(s,""),w=s;r.fillStyle=i(v.textColor,1);r.font=s+G+" "+v.textFontFamily;r.textAlign=v.textAlign;r.textBaseline=v.textBaseline;if(v.textFit){for(var C=0;C<D.length;C++){var A=r.measureText(D[C]);p=Math.max(p,A.width)}s*=(H.width/p);w*=(H.width/p)}r.font=s+G+" "+v.textFontFamily;switch(v.textAlign){default:case"left":case"start":break;case"center":F+=H.width/2;break;case"right":case"end":F+=H.width;break}switch(v.textBaseline){case"top":case"hanging":break;default:case"middle":E+=(H.height/2)-(w*(D.length-1)/2);break;case"alphabetic":case"ideographic":case"bottom":E+=H.height-(w*(D.length-1));break}for(var x=0;x<D.length;x++){r.fillText(D[x],F,E+(w*x))}}r.restore();if(v.fade){h(u).css("opacity",0).animate({opacity:1},100)}};o=function(p){p.getContext("2d").clearRect(0,0,p.width,p.height)}}else{c=function(p){return h('<var style="zoom:1;overflow:hidden;display:block;width:'+p.width+"px;height:"+p.height+'px;"></var>').get(0)};l=function(q,v,w,z,p){var u,s="",y='<v:fill color="#'+z.fillColor+'" opacity="'+(z.fill?z.fillOpacity:0)+'" />',x=(z.stroke?'strokeweight="'+z.strokeWidth+'" stroked="t" strokecolor="#'+z.strokeColor+'"':'stroked="f"'),t='<v:stroke opacity="'+z.strokeOpacity+'"/>';if(v=="rect"){u=h('<v:rect name="'+p+'" filled="t" '+x+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+w[0]+"px;top:"+w[1]+"px;width:"+(w[2]-w[0])+"px;height:"+(w[3]-w[1])+'px;"></v:rect>')}else{if(v=="poly"){u=h('<v:shape name="'+p+'" filled="t" '+x+' coordorigin="0,0" coordsize="'+q.width+","+q.height+'" path="m '+w[0]+","+w[1]+" l "+w.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+q.width+"px;height:"+q.height+'px;"></v:shape>')}else{if(v=="circ"){u=h('<v:oval name="'+p+'" filled="t" '+x+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(w[0]-w[2])+"px;top:"+(w[1]-w[2])+"px;width:"+(w[2]*2)+"px;height:"+(w[2]*2)+'px;"></v:oval>')}}}if(z.text){var r=e(v,w);s='<v:text style="zoom:1;text-align:'+z.textAlign+";font:"+z.textFontSize+z.textFontFamily+";color:#"+z.textColor+";margin:0;padding:0;display:block;position:relative;left:"+0+"px;top:"+0+"px;width:"+r.width+"px;height:"+r.height+'px;"><table cellpadding="0" cellspacing="0" style="width:100%;height:100%;"><tr><td style="vertical-align:'+z.textBaseline+'">'+z.text.replace(/\\n/g,"<br/>")+"</td></tr></table></v:textbox>"}if(u){u.get(0).innerHTML=y+t+s;h(q).append(u)}};o=function(p){h(p).find("[name=highlighted]").remove()}}n=function(q){var p,r=q.getAttribute("coords").split(",");for(p=0;p<r.length;p++){r[p]=parseFloat(r[p])}return[q.getAttribute("shape").toLowerCase().substr(0,4),r]};m=function(s,q){var p=h(s),r=h.extend({},q,h.metadata?p.metadata():false,p.data("maphilight"));if(r.text!==false&&typeof r.text!=="string"){r.text=s.title;if(r.text===""){r.text=s.alt;if(r.text===""){r.text=s.name;if(r.text===""){r.text=false}}}}return r};a=function(p){if(!p.complete){return false}if(typeof p.naturalWidth!="undefined"&&p.naturalWidth===0){return false}return true};j={position:"absolute",left:0,top:0,padding:0,border:0};var d=false;h.fn.maphilight=function(r){r=h.extend({},h.fn.maphilight.defaults,r);if(!k&&h.browser.msie&&!d){document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML");var q=document.createStyleSheet();var p=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox","text"];h.each(p,function(){q.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")});d=true}return this.each(function(){var w=h(this),u,A,t,v,x,z,y;if(!a(this)){return window.setTimeout(function(){w.maphilight(r)},200)}A=h.extend({},r,h.metadata?w.metadata():false,w.data("maphilight"));y=w.get(0).getAttribute("usemap");t=h('map[name="'+y.substr(1)+'"]');if(!(w.is("img")&&y&&t.size()>0)){return}if(w.hasClass("maphilighted")){var s=w.parent();w.insertBefore(s);s.remove();t.unbind(".maphilight").find("area[coords]").unbind(".maphilight")}u=h("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height});if(A.wrapClass){if(A.wrapClass===true){u.addClass(h(this).attr("class"))}else{u.addClass(A.wrapClass)}}w.before(u).css("opacity",0).css(j).remove();if(h.browser.msie){w.css("filter","Alpha(opacity=0)")}u.append(w);v=c(this);h(v).css(j);v.height=this.height;v.width=this.width;z=function(){var C,D;D=m(this,A);if(!D.neverOn&&!D.alwaysOn){C=n(this);l(v,C[0],C[1],D,"highlighted");if(D.groupBy){var B;if(/^[a-zA-Z][\-a-zA-Z]+$/.test(D.groupBy)){B=t.find("area["+D.groupBy+'="'+h(this).attr(D.groupBy)+'"]')}else{B=t.find(D.groupBy)}var E=this;B.each(function(){if(this!=E){var G=m(this,A);if(!G.neverOn&&!G.alwaysOn){var F=n(this);l(v,F[0],F[1],G,"highlighted")}}})}if(!k){h(v).append("<v:rect></v:rect>")}}};t.bind("alwaysOn.maphilight",function(){if(x){o(x)}if(!k){h(v).empty()}t.find("area[coords]").each(function(){var B,C;C=m(this,A);if(C.alwaysOn){if(!x&&k){x=c(w.get());h(x).css(j);x.width=w.width();x.height=w.height();w.before(x)}C.fade=C.alwaysOnFade;B=n(this);if(k){l(x,B[0],B[1],C,"")}else{l(v,B[0],B[1],C,"")}}});if(!k){h(v).append("<v:rect></v:rect>")}});t.trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",z).bind("mouseout.maphilight",function(){o(v)});w.before(v);w.addClass("maphilighted")})};h.fn.maphilight.defaults={fill:true,fillColor:"000000",fillOpacity:0.2,stroke:true,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:true,alwaysOn:false,neverOn:false,groupBy:false,wrapClass:true,shadow:false,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:0.8,shadowPosition:"outside",shadowFrom:false,text:true,textFontFamily:"Arial",textFontSize:"10px",textColor:"000000",textBaseline:"middle",textAlign:"center",textFit:false}})(jQuery);