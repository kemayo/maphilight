(function(a){var b,c,d,e,f,g,h,j,k,l,m;b=document.namespaces;c=!!document.createElement("canvas").getContext;if(!(c||b)){a.fn.maphilight=function(){return this};return}if(c){j=function(a){return Math.max(0,Math.min(parseInt(a,16),255))};k=function(a,b){return"rgba("+j(a.substr(0,2))+","+j(a.substr(2,2))+","+j(a.substr(4,2))+","+b+")"};d=function(b){var c=a('<canvas style="width:'+b.width+"px;height:"+b.height+'px;"></canvas>').get(0);c.getContext("2d").clearRect(0,0,c.width,c.height);return c};var n=function(a,b,c,d,e){d=d||0;e=e||0;a.beginPath();if(b=="rect"){a.rect(c[0]+d,c[1]+e,c[2]-c[0],c[3]-c[1])}else if(b=="poly"){a.moveTo(c[0]+d,c[1]+e);for(i=2;i<c.length;i+=2){a.lineTo(c[i]+d,c[i+1]+e)}}else if(b=="circ"){a.arc(c[0]+d,c[1]+e,c[2],0,Math.PI*2,false)}a.closePath()};e=function(b,c,d,e,f){var g,h=b.getContext("2d");if(e.shadow){h.save();if(e.shadowPosition=="inside"){n(h,c,d);h.clip()}var i=b.width*100;var j=b.height*100;n(h,c,d,i,j);h.shadowOffsetX=e.shadowX-i;h.shadowOffsetY=e.shadowY-j;h.shadowBlur=e.shadowRadius;h.shadowColor=k(e.shadowColor,e.shadowOpacity);var l=e.shadowFrom;if(!l){if(e.shadowPosition=="outside"){l="fill"}else{l="stroke"}}if(l=="stroke"){h.strokeStyle="rgba(0,0,0,1)";h.stroke()}else if(l=="fill"){h.fillStyle="rgba(0,0,0,1)";h.fill()}h.restore();if(e.shadowPosition=="outside"){h.save();n(h,c,d);h.globalCompositeOperation="destination-out";h.fillStyle="rgba(0,0,0,1);";h.fill();h.restore()}}h.save();n(h,c,d);if(e.fill){h.fillStyle=k(e.fillColor,e.fillOpacity);h.fill()}if(e.stroke){h.strokeStyle=k(e.strokeColor,e.strokeOpacity);h.lineWidth=e.strokeWidth;h.stroke()}h.restore();if(e.fade){a(b).css("opacity",0).animate({opacity:1},100)}};f=function(a){a.getContext("2d").clearRect(0,0,a.width,a.height)}}else{d=function(b){return a('<var style="zoom:1;overflow:hidden;display:block;width:'+b.width+"px;height:"+b.height+'px;"></var>').get(0)};e=function(b,c,d,e,f){var g,h,i,j;g='<v:fill color="#'+e.fillColor+'" opacity="'+(e.fill?e.fillOpacity:0)+'" />';h=e.stroke?'strokeweight="'+e.strokeWidth+'" stroked="t" strokecolor="#'+e.strokeColor+'"':'stroked="f"';i='<v:stroke opacity="'+e.strokeOpacity+'"/>';if(c=="rect"){j=a('<v:rect name="'+f+'" filled="t" '+h+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+d[0]+"px;top:"+d[1]+"px;width:"+(d[2]-d[0])+"px;height:"+(d[3]-d[1])+'px;"></v:rect>')}else if(c=="poly"){j=a('<v:shape name="'+f+'" filled="t" '+h+' coordorigin="0,0" coordsize="'+b.width+","+b.height+'" path="m '+d[0]+","+d[1]+" l "+d.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+b.width+"px;height:"+b.height+'px;"></v:shape>')}else if(c=="circ"){j=a('<v:oval name="'+f+'" filled="t" '+h+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(d[0]-d[2])+"px;top:"+(d[1]-d[2])+"px;width:"+d[2]*2+"px;height:"+d[2]*2+'px;"></v:oval>')}j.get(0).innerHTML=g+i;a(b).append(j)};f=function(b){a(b).find("[name=highlighted]").remove()}}g=function(a){var b,c=a.getAttribute("coords").split(",");for(b=0;b<c.length;b++){c[b]=parseFloat(c[b])}return[a.getAttribute("shape").toLowerCase().substr(0,4),c]};m=function(b,c){var d=a(b);var e=a(b).attr("id");if(c.areas){if(c.areas[e]){jQuery.each(o,function(a,b){c[a]=o[a];jQuery.each(c.areas[e],function(d,e){if(a==d&&b!=e){c[d]=e}})})}else{jQuery.each(o,function(a,b){if(c[a]!=b){c[a]=b}})}}return a.extend({},c,a.metadata?d.metadata():false,d.data("maphilight"))};l=function(a){if(!a.complete){return false}if(typeof a.naturalWidth!="undefined"&&a.naturalWidth==0){return false}return true};h={position:"absolute",left:0,top:0,padding:0,border:0};var o;var p=false;a.fn.maphilight=function(b){b=a.extend({},a.fn.maphilight.defaults,b);o=b;if(!c&&a.browser.msie&&!p){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var i=document.createStyleSheet();var j=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];a.each(j,function(){i.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")});p=true}return this.each(function(){var i,j,k,n,o,p,q,r,s;i=a(this);if(!l(this)){return window.setTimeout(function(){i.maphilight(b)},200)}k=a.extend({},b,a.metadata?i.metadata():false,i.data("maphilight"));s=i.get(0).getAttribute("usemap");n=a('map[name="'+s.substr(1)+'"]');if(!(i.is("img")&&s&&n.size()>0)){return}if(i.hasClass("maphilighted")){var t=i.parent();i.insertBefore(t);t.remove();a(n).unbind(".maphilight").find("area[coords]").unbind(".maphilight")}j=a("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height});if(k.wrapClass){if(k.wrapClass===true){j.addClass(a(this).attr("class"))}else{j.addClass(k.wrapClass)}}i.before(j).css("opacity",0).css(h).remove();if(a.browser.msie){i.css("filter","Alpha(opacity=0)")}j.append(i);o=d(this);a(o).css(h);o.height=this.height;o.width=this.width;q=function(b){var d,f;f=m(this,k);if(!f.neverOn&&!f.alwaysOn){d=g(this);e(o,d[0],d[1],f,"highlighted");if(f.groupBy){var h;if(/^[a-zA-Z][-a-zA-Z]+$/.test(f.groupBy)){h=n.find("area["+f.groupBy+'="'+a(this).attr(f.groupBy)+'"]')}else{h=n.find(f.groupBy)}var i=this;h.each(function(){if(this!=i){var a=m(this,k);if(!a.neverOn&&!a.alwaysOn){var b=g(this);e(o,b[0],b[1],a,"highlighted")}}})}if(!c){a(o).append("<v:rect></v:rect>")}}};a(n).bind("alwaysOn.maphilight",function(){if(p){f(p)}if(!c){a(o).empty()}a(n).find("area[coords]").each(function(){var b,f;f=m(this,k);if(f.alwaysOn){if(!p&&c){p=d(i.get());a(p).css(h);p.width=i.width();p.height=i.height();i.before(p)}f.fade=f.alwaysOnFade;b=g(this);if(c){e(p,b[0],b[1],f,"")}else{e(o,b[0],b[1],f,"")}}})});a(n).trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",q).bind("mouseout.maphilight",function(a){f(o)});i.before(o);i.addClass("maphilighted")})};a.fn.maphilight.defaults={fill:true,fillColor:"000000",fillOpacity:.2,stroke:true,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:true,alwaysOn:false,neverOn:false,groupBy:false,wrapClass:true,shadow:false,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:false}})(jQuery)