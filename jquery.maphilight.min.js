(function(g){var b,k,c,l,o,n,j,e,h,a,m;k=!!document.createElement("canvas").getContext;b=(function(){var q=document.createElement("div");q.innerHTML='<v:shape id="vml_flag1" adj="1" />';var p=q.firstChild;p.style.behavior="url(#default#VML)";return p?typeof p.adj=="object":true})();if(!(k||b)){g.fn.maphilight=function(){return this};return}if(k){e=function(p){return Math.max(0,Math.min(parseInt(p,16),255))};h=function(p,q){return"rgba("+e(p.substr(0,2))+","+e(p.substr(2,2))+","+e(p.substr(4,2))+","+q+")"};c=function(p){var q=g('<canvas style="width:'+p.width+"px;height:"+p.height+'px;"></canvas>').get(0);q.getContext("2d").clearRect(0,0,q.width,q.height);return q};var f=function(r,p,s,q,t){q=q||0;t=t||0;r.beginPath();if(p=="rect"){r.rect(s[0]+q,s[1]+t,s[2]-s[0],s[3]-s[1])}else{if(p=="poly"){r.moveTo(s[0]+q,s[1]+t);for(i=2;i<s.length;i+=2){r.lineTo(s[i]+q,s[i+1]+t)}}else{if(p=="circ"){r.arc(s[0]+q,s[1]+t,s[2],0,Math.PI*2,false)}}}r.closePath()};l=function(r,u,v,y,p){var t,q=r.getContext("2d");if(y.shadow){q.save();if(y.shadowPosition=="inside"){f(q,u,v);q.clip()}var s=r.width*100;var x=r.height*100;f(q,u,v,s,x);q.shadowOffsetX=y.shadowX-s;q.shadowOffsetY=y.shadowY-x;q.shadowBlur=y.shadowRadius;q.shadowColor=h(y.shadowColor,y.shadowOpacity);var w=y.shadowFrom;if(!w){if(y.shadowPosition=="outside"){w="fill"}else{w="stroke"}}if(w=="stroke"){q.strokeStyle="rgba(0,0,0,1)";q.stroke()}else{if(w=="fill"){q.fillStyle="rgba(0,0,0,1)";q.fill()}}q.restore();if(y.shadowPosition=="outside"){q.save();f(q,u,v);q.globalCompositeOperation="destination-out";q.fillStyle="rgba(0,0,0,1);";q.fill();q.restore()}}q.save();f(q,u,v);if(y.fill){q.fillStyle=h(y.fillColor,y.fillOpacity);q.fill()}if(y.stroke){q.strokeStyle=h(y.strokeColor,y.strokeOpacity);q.lineWidth=y.strokeWidth;q.stroke()}q.restore();if(y.fade){g(r).css("opacity",0).animate({opacity:1},100)}};o=function(p){p.getContext("2d").clearRect(0,0,p.width,p.height)}}else{c=function(p){return g('<var style="zoom:1;overflow:hidden;display:block;width:'+p.width+"px;height:"+p.height+'px;"></var>').get(0)};l=function(q,t,u,x,p){var v,w,r,s;v='<v:fill color="#'+x.fillColor+'" opacity="'+(x.fill?x.fillOpacity:0)+'" />';w=(x.stroke?'strokeweight="'+x.strokeWidth+'" stroked="t" strokecolor="#'+x.strokeColor+'"':'stroked="f"');r='<v:stroke opacity="'+x.strokeOpacity+'"/>';if(t=="rect"){s=g('<v:rect name="'+p+'" filled="t" '+w+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+u[0]+"px;top:"+u[1]+"px;width:"+(u[2]-u[0])+"px;height:"+(u[3]-u[1])+'px;"></v:rect>')}else{if(t=="poly"){s=g('<v:shape name="'+p+'" filled="t" '+w+' coordorigin="0,0" coordsize="'+q.width+","+q.height+'" path="m '+u[0]+","+u[1]+" l "+u.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+q.width+"px;height:"+q.height+'px;"></v:shape>')}else{if(t=="circ"){s=g('<v:oval name="'+p+'" filled="t" '+w+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(u[0]-u[2])+"px;top:"+(u[1]-u[2])+"px;width:"+(u[2]*2)+"px;height:"+(u[2]*2)+'px;"></v:oval>')}}}s.get(0).innerHTML=v+r;g(q).append(s)};o=function(q){var p=g("<div>"+q.innerHTML+"</div>");p.children("[name=highlighted]").remove();q.innerHTML=p.html()}}n=function(q){var p,r=q.getAttribute("coords").split(",");for(p=0;p<r.length;p++){r[p]=parseFloat(r[p])}return[q.getAttribute("shape").toLowerCase().substr(0,4),r]};m=function(r,q){var p=g(r);return g.extend({},q,g.metadata?p.metadata():false,p.data("maphilight"))};a=function(p){if(!p.complete){return false}if(typeof p.naturalWidth!="undefined"&&p.naturalWidth===0){return false}return true};j={position:"absolute",left:0,top:0,padding:0,border:0};var d=false;g.fn.maphilight=function(p){p=g.extend({},g.fn.maphilight.defaults,p);if(!k&&!d){g(window).ready(function(){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var r=document.createStyleSheet();var q=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];g.each(q,function(){r.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")})});d=true}return this.each(function(){var v,s,z,r,u,w,y,t,x;v=g(this);if(!a(this)){return window.setTimeout(function(){v.maphilight(p)},200)}z=g.extend({},p,g.metadata?v.metadata():false,v.data("maphilight"));x=v.get(0).getAttribute("usemap");if(!x){return}r=g('map[name="'+x.substr(1)+'"]');if(!(v.is('img,input[type="image"]')&&x&&r.size()>0)){return}if(v.hasClass("maphilighted")){var q=v.parent();v.insertBefore(q);q.remove();g(r).unbind(".maphilight").find("area[coords]").unbind(".maphilight")}s=g("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height});if(z.wrapClass){if(z.wrapClass===true){s.addClass(g(this).attr("class"))}else{s.addClass(z.wrapClass)}}v.before(s).css("opacity",0).css(j).remove();if(b){v.css("filter","Alpha(opacity=0)")}s.append(v);u=c(this);g(u).css(j);u.height=this.height;u.width=this.width;y=function(D){var B,C;C=m(this,z);if(!C.neverOn&&!C.alwaysOn){B=n(this);l(u,B[0],B[1],C,"highlighted");if(C.groupBy){var A;if(/^[a-zA-Z][\-a-zA-Z]+$/.test(C.groupBy)){A=r.find("area["+C.groupBy+'="'+g(this).attr(C.groupBy)+'"]')}else{A=r.find(C.groupBy)}var E=this;A.each(function(){if(this!=E){var G=m(this,z);if(!G.neverOn&&!G.alwaysOn){var F=n(this);l(u,F[0],F[1],G,"highlighted")}}})}if(!k){g(u).append("<v:rect></v:rect>")}}};g(r).bind("alwaysOn.maphilight",function(){if(w){o(w)}if(!k){g(u).empty()}g(r).find("area[coords]").each(function(){var A,B;B=m(this,z);if(B.alwaysOn){if(!w&&k){w=c(v[0]);g(w).css(j);w.width=v[0].width;w.height=v[0].height;v.before(w)}B.fade=B.alwaysOnFade;A=n(this);if(k){l(w,A[0],A[1],B,"")}else{l(u,A[0],A[1],B,"")}}})});g(r).trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",y).bind("mouseout.maphilight",function(A){o(u)});v.before(u);v.addClass("maphilighted")})};g.fn.maphilight.defaults={fill:true,fillColor:"000000",fillOpacity:0.2,stroke:true,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:true,alwaysOn:false,neverOn:false,groupBy:false,wrapClass:true,shadow:false,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:0.8,shadowPosition:"outside",shadowFrom:false}})(jQuery);
